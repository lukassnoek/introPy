
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Creating a Coder experiment from scratch (tutorial) &#8212; introPy</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to continue with PsychoPy?" href="psychopy_how_to_continue.html" />
    <link rel="prev" title="Introduction to the PsychoPy Coder (tutorial)" href="psychopy_coder_part1.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">introPy</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Welcome to introPy
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Getting started
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started/about.html">
   About this course
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../getting_started/jupyter.html">
   The Jupyter ecosystem
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Python (week 1)
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../week_1/python.html">
   Python essentials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../solutions/week_1/0_introduction.html">
   Introduction to Python (T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../solutions/week_1/1_python_basics.html">
   Python basics (T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../solutions/week_1/2_matplotlib.html">
   Introduction to Matplotlib (T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../solutions/week_1/3_pandas.html">
   Introduction to Pandas (T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../solutions/week_1/4_numpy.html">
   Introduction to Numpy (T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../week_1/python_how_to_continue.html">
   How to continue with Python?
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  PsychoPy (week 2)
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="psychopy.html">
   PsychoPy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_psychopy.html">
   Introduction to PsychoPy (T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="psychopy_builder_part1.html">
   Introduction to the Builder (T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="psychopy_builder_part2.html">
   A Builder experiment from scratch (T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="psychopy_coder_part1.html">
   Introduction to the Coder (T)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   A Coder experiment from scratch (T)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="psychopy_how_to_continue.html">
   How to continue with PsychoPy?
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Misc
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/bibliography.html">
   Bibliography
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/for_developers.html">
   For developers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/CONTRIBUTING.html">
   Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../misc/CONDUCT.html">
   Code of Conduct
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/week_2/psychopy_coder_part2.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/lukassnoek/introPy"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/lukassnoek/introPy/issues/new?title=Issue%20on%20page%20%2Fweek_2/psychopy_coder_part2.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/lukassnoek/introPy/edit/master/intropy/week_2/psychopy_coder_part2.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#components">
   Components
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#drawing-flipping">
   Drawing &amp; flipping
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#responses">
   Responses
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#timing-revisited">
   Timing revisited
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#clock-based-timing">
     Clock-based timing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#frame-based-timing-optional">
     Frame-based timing (optional)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trial-loops">
   Trial loops
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-responses-and-stimulus-onsets">
   Saving responses and stimulus onsets
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#non-slip-timing-optional">
   Non-slip timing (optional)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wrapping-up">
   Wrapping up
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="creating-a-coder-experiment-from-scratch-tutorial">
<h1>Creating a Coder experiment from scratch (tutorial)<a class="headerlink" href="#creating-a-coder-experiment-from-scratch-tutorial" title="Permalink to this headline">¶</a></h1>
<p>In the previous tutorial, we discussed most of the “administrative” stuff that needs to happen in any PsychoPy experiment and explained some basic features (clocks, responses). In this tutorial, we’ll discuss how to actually add components to the experiment, interact with user responses, and work with user data. There are a lot of optional, more advanced topics/sections in this tutorial, so feel free to skip those if you are short on time.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>PsychoPy is an incredibly versatile and flexible software package. The “downside” of this is that sometimes the same thing can be achieved in multiple different ways. In this tutorial, we’ll highlight different approaches when appropriate, but remember that almost always these approaches are functionally equivalent, so it’s up to you which approach you use!</p>
</div>
<p>We of course assume you finished the previous tutorial already. In this tutorial, we are going to continue our experiment with what we ended up with from the last tutorial. If you want, you can copy the (correct) code from the previous tutorial below, which we’ll extend in this tutorial.</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click to reveal the template!<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">psychopy.gui</span> <span class="kn">import</span> <span class="n">DlgFromDict</span>
<span class="kn">from</span> <span class="nn">psychopy.visual</span> <span class="kn">import</span> <span class="n">Window</span>
<span class="kn">from</span> <span class="nn">psychopy.core</span> <span class="kn">import</span> <span class="n">Clock</span><span class="p">,</span> <span class="n">quit</span><span class="p">,</span> <span class="n">wait</span>
<span class="kn">from</span> <span class="nn">psychopy.event</span> <span class="kn">import</span> <span class="n">Mouse</span>
<span class="kn">from</span> <span class="nn">psychopy.hardware.keyboard</span> <span class="kn">import</span> <span class="n">Keyboard</span>

<span class="c1">### DIALOG BOX ROUTINE ###</span>
<span class="n">exp_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;participant_nr&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
<span class="n">dlg</span> <span class="o">=</span> <span class="n">DlgFromDict</span><span class="p">(</span><span class="n">exp_info</span><span class="p">)</span>

<span class="c1"># If pressed Cancel, abort!</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">dlg</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
    <span class="n">quit</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Quit when either the participant nr or age is not filled in</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;participant_nr&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]:</span>
        <span class="n">quit</span><span class="p">()</span>
        
    <span class="c1"># Also quit in case of invalid participant nr or age</span>
    <span class="k">if</span> <span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;participant_nr&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">99</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">18</span><span class="p">:</span>
        <span class="n">quit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># let&#39;s star the experiment!</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Started experiment for participant </span><span class="si">{</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;participant_nr&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span>
                 <span class="sa">f</span><span class="s2">&quot;with age </span><span class="si">{</span><span class="n">exp_info</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="c1"># Initialize a fullscreen window with my monitor (HD format) size</span>
<span class="c1"># and my monitor specification called &quot;samsung&quot; from the monitor center</span>
<span class="n">win</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="n">fullscr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;samsung&#39;</span><span class="p">)</span>

<span class="c1"># Also initialize a mouse, for later</span>
<span class="c1"># We&#39;ll set it to invisible for now</span>
<span class="n">mouse</span> <span class="o">=</span> <span class="n">Mouse</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Initialize a (global) clock</span>
<span class="n">clock</span> <span class="o">=</span> <span class="n">Clock</span><span class="p">()</span>

<span class="c1"># Initialize Keyboard</span>
<span class="n">kb</span> <span class="o">=</span> <span class="n">Keyboard</span><span class="p">()</span>

<span class="c1">### START BODY OF EXPERIMENT ###</span>
<span class="c1">#</span>
<span class="c1"># This is where we&#39;ll add stuff from the second</span>
<span class="c1"># Coder tutorial.</span>
<span class="c1">#</span>
<span class="c1">### END BODY OF EXPERIMENT ###</span>

<span class="c1"># Finish experiment by closing window and quitting</span>
<span class="n">win</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">quit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details><div class="section" id="components">
<h2>Components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h2>
<p>Like in the Builder, <em>components</em> are the “bread and butter” in the Coder interface as well. In the coder, however, these components are implemented in different classes from the <code class="docutils literal notranslate"><span class="pre">psychopy</span></code> package. For example, to add a text component, you can use the <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> class from the <code class="docutils literal notranslate"><span class="pre">psychopy.visual</span></code> module and to add a sound component, you can use the <code class="docutils literal notranslate"><span class="pre">Sound</span></code> component from the <code class="docutils literal notranslate"><span class="pre">psychopy.sound</span></code> module.</p>
<p>Basically, every component from the Builder has an equivalent in the <code class="docutils literal notranslate"><span class="pre">psychopy</span></code> package. Moreover, each component has largely the same properties in the Builder as in the Coder. For example, the <em>color</em> and <em>font</em> properties from text components in the Builder are also available in the Coder interface as arguments (and attributes) of the corresponding component class. For example, to set the font of a text stim to Calibri and the text color to blue, initialize a <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> object with <code class="docutils literal notranslate"><span class="pre">font='Calibri'</span></code> and <code class="docutils literal notranslate"><span class="pre">color=(-1,</span> <span class="pre">-1,</span> <span class="pre">1)</span></code>. We won’t discuss all parameters from every component we discuss in this tutorial; you can find all parameters and what they mean in the <a class="reference external" href="https://www.psychopy.org/api/index.html">PsychoPy documentation</a>!</p>
<p>Importantly, all <em>visual</em> stimulus classes (like <code class="docutils literal notranslate"><span class="pre">TextStim</span></code>, but not <code class="docutils literal notranslate"><span class="pre">Sound</span></code>) additionally need one (mandatory) argument: a <code class="docutils literal notranslate"><span class="pre">Window</span></code> object! This allows to <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> to interact with the window. So, let’s recap: to initialize a component in the Coder interface, we need to (1) import the corresponding class and (2) initialize it with a <code class="docutils literal notranslate"><span class="pre">Window</span></code> object (in case of visual components) and optionally other arguments that modify the component’s behavior or display.</p>
<p>Now, suppose you would like to welcome my participant by showing a short welcome message — “Welcome to this experiment!”. To do so, you’d need a <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> which would need to be initialized as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">psychopy.visual</span> <span class="kn">import</span> <span class="n">TextStim</span>

<span class="c1"># We assume `win` already exists</span>
<span class="n">welcome_txt_stim</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Welcome to this experiment!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Paste the code snippet above into your script, after initializing the window and clock, but change the initialization such that the text will be orange and set the font to Calibri. Note: it’s convention to put all import statements together at the top of your script, so make sure the <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">psychopy.visual</span> <span class="pre">import</span> <span class="pre">TextStim</span></code> part is on top of your script as well. Then, run the experiment.</p>
<p>Note: you probably won’t actually see the welcome text (or very briefly)! The reason for this is explained in the next section.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Like we mentioned in the previous tutorial, if no window opens at all when running your experiment, your script may contain a (syntax) error! In that case, check the <em>Experiment runner</em> window to see what’s wrong!</p>
</div>
<p>Note that component properties (such as the text <code class="docutils literal notranslate"><span class="pre">font</span></code> and <code class="docutils literal notranslate"><span class="pre">color</span></code> of <code class="docutils literal notranslate"><span class="pre">TextStim</span></code>s) can also be set <em>after</em> initializing the object. Because these arguments are set as attributes during initialization in the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> function, you can change these properties by changing the object’s attributes. For example, if you want to change the font size (<code class="docutils literal notranslate"><span class="pre">height</span></code>) after initialization of a <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> object, you can do the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start with a height (font size) of 0.1</span>
<span class="n">some_txt</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="s2">&quot;Hello!&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Later, increase it to 0.2</span>
<span class="n">some_txt</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mf">0.2</span>
</pre></div>
</div>
<p>In the documentation, you may have seen that some attributes can also be changed using a dedicated method, with the same name as the attribute but prefixed with “set”. For example, changing the font size of a <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> (as in the previous code snippet) could also be achieved as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">some_txt</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="s2">&quot;Hello!&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">some_txt</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
<p>It really doesn’t matter which method (setting the attribute directly or using the <code class="docutils literal notranslate"><span class="pre">set</span></code> method) you use — they do the same thing.</p>
</div>
<div class="section" id="drawing-flipping">
<h2>Drawing &amp; flipping<a class="headerlink" href="#drawing-flipping" title="Permalink to this headline">¶</a></h2>
<p>When running your experiment after including the welcome text component, however, the PsychoPy window does not show the text! As discussed in the lecture, this is because you first need to <em>draw</em> the stimulus! This can be done by calling the <code class="docutils literal notranslate"><span class="pre">draw</span></code> method that is included in each (visual) component class.</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>After initialization of the text component, call the <code class="docutils literal notranslate"><span class="pre">draw</span></code> method (without arguments) of the <code class="docutils literal notranslate"><span class="pre">welcome_txt_stim</span></code> variable. Then, run your experiment.</p>
</div>
<p>Argh, still no sign of the welcome text in the window! This is because your monitor contains <a class="reference external" href="https://en.wikipedia.org/wiki/Multiple_buffering">two buffers</a>, a “front buffer” (which is visible) and a “back buffer” (which isn’t), and components are always drawn on the back buffer! To make the drawn components visible, we need to flip the back buffer to the front, which can be done by calling the <code class="docutils literal notranslate"><span class="pre">flip</span></code> method of the <code class="docutils literal notranslate"><span class="pre">Window</span></code> object. By splitting the operation of showing stimuli into two operations (drawing and flipping the back buffer), you can precisely control when you want your stimuli to appear (i.e., when calling <code class="docutils literal notranslate"><span class="pre">flip</span></code>).</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Right after the call to the <code class="docutils literal notranslate"><span class="pre">draw</span></code> method of the text component (<code class="docutils literal notranslate"><span class="pre">welcome_txt_stim</span></code>), add a call to the <code class="docutils literal notranslate"><span class="pre">flip</span></code> method (without arguments) of the window (<code class="docutils literal notranslate"><span class="pre">win</span></code>). Then, run the experiment again.</p>
</div>
<p>Finally, you should see the welcome text on the window, albeit quite briefly! Again, it is only shown briefly because PsychoPy will simply follow the script and immediatly go to the next lines (which presumably are those that close the window and quit the experiment, like we discussed in the previous tutorial). There are several ways in which you can specify how long a component is visible, which differ in how precisely they can determine the duration. One of the easiest ways is to add a call to the <code class="docutils literal notranslate"><span class="pre">wait</span></code> function after the window flip.</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">wait</span></code> function, make PsychoPy wait for 2 seconds after flipping the window. Then, run the experiment again.</p>
</div>
<p>Now you should see that the welcome text is visible for 2 seconds (actually, a bit longer because of the time it takes to shut down the experiment). In one of the next sections, we will discuss other, and more precise, methods to manipulate the duration of stimuli.</p>
<p>Note that after flipping the window such that the back buffer is moved to the front buffer, the back buffer is completely cleared. This means that when you’d flip the window <em>again</em> (without drawing any stuff in the meantime), the front buffer would contain an empty window!</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>After the call to the <code class="docutils literal notranslate"><span class="pre">wait</span></code> function, flip the window again, and add another call to the <code class="docutils literal notranslate"><span class="pre">wait</span></code> function for two seconds (otherwise you won’t see the effect of the second flip). Then, run the experiment again.</p>
</div>
<p>By flipping the window again, the welcome text disappeared and was replaced by an empty window (because the front buffer was replaced by an empty back buffer). This underlines an important concept: <em>every time you flip the window, you start with an empty back buffer</em> (and you need to draw your stimuli again, if you want to show them again on the next flip).</p>
</div>
<div class="section" id="responses">
<h2>Responses<a class="headerlink" href="#responses" title="Permalink to this headline">¶</a></h2>
<p>After welcoming our participant, let’s add some instructions. Like we did in the Builder experiment, let’s also make sure that, after reading the instructions, the participant can continue the experiment by pressing enter (“return”). This gives us an excuse to introduce the topic of working with participant responses!</p>
<p>But first, let’s create a <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> with the instructions:</p>
<blockquote>
<div><p>In this experiment, you will see emotional faces (either happy or angry) with a word above the image (either “happy” or “angry”).
Importantly, you need to respond to the EXPRESSION of the face and ignore the word. You respond with the arrow keys:</p>
<p>HAPPY expression = left<br>
ANGRY expression = right</p>
<p>(Press ‘enter’ to start the experiment!)</p>
</div></blockquote>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Initialize a <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> object with the text above and store it in a variable named <code class="docutils literal notranslate"><span class="pre">instruct_txt_stim</span></code>. Make sure it is left-aligned and has a font size of 0.085 (check the <a class="reference external" href="https://www.psychopy.org/api/visual/textstim.html">docs</a> to see how to do this). Then, draw the <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> and flip the window to make it visible!</p>
<p>Tip: you can create multi-line strings easily by enclosing text in triple-quotes, e.g., <code class="docutils literal notranslate"><span class="pre">&quot;&quot;&quot;</span> <span class="pre">some</span> <span class="pre">multiline</span> <span class="pre">text</span> <span class="pre">etc</span> <span class="pre">etc</span> <span class="pre">&quot;&quot;&quot;</span></code> (more info <a class="reference external" href="https://stackoverflow.com/questions/10660435/pythonic-way-to-create-a-long-multi-line-string">here</a>). Then, call its <code class="docutils literal notranslate"><span class="pre">draw</span></code> method, flip the window to make it visible.</p>
</div>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">Keyboard</span></code> class, make sure the experiment only advances when the participant presses the enter key. Check the previous tutorial if you forgot how to do this!</p>
</div>
</div>
<div class="section" id="timing-revisited">
<h2>Timing revisited<a class="headerlink" href="#timing-revisited" title="Permalink to this headline">¶</a></h2>
<p>Alright, now it’s time for the most important part of our experiments: the trial loop! Just like the color-word Stroop experiment we implemented in the Builder, we’d like to create a set of trials in our emotion-word Stroop experiment. This also provides us with a nice opportunity to talk about duration and timing again!</p>
<p>Often, you’d like to make sure your trials/stimuli are presented for a specific duration. This is often especially important for perception and psychophysics studies or neuroimaging studies in which you track stimulus processing at high temporal resolution (e.g., EEG/MEG and eyetracking studies).</p>
<p>So far, we only showed you how to use the <code class="docutils literal notranslate"><span class="pre">wait</span></code> function to control stimulus duration. There are, however, two other and more precise methods, which we’ll call <em>clock-based</em> timing and <em>frame-based</em> timing. We’ll discuss these two methods in turn. But first, let’s discuss how we want to structure our trial.</p>
<p>Like we did in the Builder experiment, let our trial routine include the emotion-word stimulus and a subsequent fixation target. Unlike our Builder experiment, let’s only present the stimulus for a fixed amount of time, let’s say 500 milliseconds, which is followed by a fixation cross (a simple “+” sign) for 1500 milliseconds. As such, our trial will take (500 + 1500 = ) 2000 milliseconds; this is sometimes called the inter-<strong>trial</strong> interval (ITI), i.e., the time from the onset of one trial to the onset of the next trial.Figure 1 shows how this routine would have looked like in the Builder view.</p>
<div class="figure align-default" id="emo-stroop-trial-routine">
<img alt="../_images/trial_routine_emo_stroop.png" src="../_images/trial_routine_emo_stroop.png" />
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">The trial routine of the emotion-word Stroop experiment.</span><a class="headerlink" href="#emo-stroop-trial-routine" title="Permalink to this image">¶</a></p>
</div>
<p>As we’re creating an emotion-word Stroop task, we’ll need an image with a emotional facial expression and an emotion word. To create an image, you can use the <a class="reference external" href="https://www.psychopy.org/api/visual/imagestim.html"><code class="docutils literal notranslate"><span class="pre">ImageStim</span></code></a> class from the <code class="docutils literal notranslate"><span class="pre">psychopy.visual</span></code> module. Apart from the mandatory argument <code class="docutils literal notranslate"><span class="pre">win</span></code> (the current window), it also needs an <code class="docutils literal notranslate"><span class="pre">image</span></code> (a path to the image file). In the <code class="docutils literal notranslate"><span class="pre">tutorials/week_2</span></code> directory, we included two images: <code class="docutils literal notranslate"><span class="pre">angry.png</span></code> and <code class="docutils literal notranslate"><span class="pre">happy.png</span></code>. Note that these images are smileys, because it’s really hard to find proper facial expression stimuli without copyright …</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Import the <code class="docutils literal notranslate"><span class="pre">ImageStim</span></code> class, initialize an <code class="docutils literal notranslate"><span class="pre">ImageStim</span></code> object with the <code class="docutils literal notranslate"><span class="pre">angry.png</span></code> file (store this is in a variable with the name <code class="docutils literal notranslate"><span class="pre">stim_img</span></code>), and draw it. Also create a <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> with the word “happy” placed above the smiley (store this is in a variable with the name <code class="docutils literal notranslate"><span class="pre">stim_txt</span></code>) and draw it. Then, flip the window and run the experiment to see whether it works as expected. You should only see the smiley briefly.</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click here to show the solution (but try it yourself first!)<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stim_img</span> <span class="o">=</span> <span class="n">ImageStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;angry.png&#39;</span><span class="p">)</span>
<span class="n">stim_img</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">stim_txt</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;happy&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">stim_txt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">win</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details></div>
<p>Disregarding the timimg issue completely for now, let’s also create a fixation target to show after the smiley.</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Initialize a fixation target with a “+” sign using a <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> (store it in a variable named <code class="docutils literal notranslate"><span class="pre">fix_target</span></code>) and draw and show it after showing the stimulus image (<code class="docutils literal notranslate"><span class="pre">angry.png</span></code>) and stimulus text (“happy”). Then, run the experiment (you should only see the stimulus and subsequent fixation cross very briefly; we’ll fix that in the next section).</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click here to show the solution (but try it yourself first!)<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This comes immediately after the code from the previous ToDo</span>
<span class="n">fix_target</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">)</span>
<span class="n">fix_target</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">win</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details></div>
<p>At this point, we haven’t specified for <em>how long</em> we’d like to show our stimulus and fixation target! After showing the stimulus, it will immediately advance to drawing and showing the fixation target (showing both, effectively, for only one frame or “flip”). One way to control this duration is, as discussed before, using the <code class="docutils literal notranslate"><span class="pre">wait</span></code> function: we could add a call to wait after showing the stimulus (for 500 ms.) and after showing the fixation target (for 1500 ms.). This would definitely work, but the next two sections outline two slightly more precise methods to do so.</p>
<div class="section" id="clock-based-timing">
<h3>Clock-based timing<a class="headerlink" href="#clock-based-timing" title="Permalink to this headline">¶</a></h3>
<p>In the previous tutorial, we defined a “clock” (using the <code class="docutils literal notranslate"><span class="pre">psychopy.core.Clock</span></code> class) to do some trivial timing checks, but they can be used in much more useful ways, like controlling the duration of stimuli. We <em>could</em> use the previously defined “global” clock (the <code class="docutils literal notranslate"><span class="pre">clock</span></code> variable from the previous tutorial) for this, but we’ll actually need that for logging trial onsets later (in an optional section). Instead, let’s create a new <code class="docutils literal notranslate"><span class="pre">Clock</span></code> object to keep track of the duration of our trial components, which we’ll call <code class="docutils literal notranslate"><span class="pre">trial_clock</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trial_clock</span> <span class="o">=</span> <span class="n">Clock</span><span class="p">()</span>
</pre></div>
</div>
<p>At initialization, the clock is at ~0 seconds. Using a while loop, we can use this clock to continuously draw the stimulus (if the clock &lt; 500 ms) or the fixation target (if the clock is between 500 and 2000 ms) and flip the window!</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Implement the aforementioned while loop in which either the stimulus (smiley and emotion word) or the fixation target is shown, depending on the time since the initialization of the clock (so you need an if-else statement as well)!</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click here to show the solution (but try it yourself first!)<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># We assume that the fix_target and stim_txt/stim_img are</span>
<span class="c1"># already defined!</span>
<span class="k">while</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="c1"># Draw stimulus or fix depending on time</span>
    <span class="k">if</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">stim_txt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">stim_img</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fix_target</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    
    <span class="c1"># Show whatever is drawn!</span>
    <span class="n">win</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details></div>
<p>You may think: why redraw the components (and flip the window) on <em>every</em> iteration? This is, indeed, not necessary; technically, you only need to draw each component once (the stimulus at 0 ms and the fixation target at 500 ms). However, when programming more complex experiments, you’ll notice that this convention of drawing your components and flipping your windows <em>every iteration</em> actually yields very readable code. Also, (re)drawing the stimuli and flipping the window every iteration does not incur much of a performance hit, as most of the heavy lifting is done by your computer’s graphics card (and not your CPU).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Instead of re-drawing your stimuli every iteration of the loop across frames, you can also set the attribute <code class="docutils literal notranslate"><span class="pre">autoDraw</span></code> of visual components to <code class="docutils literal notranslate"><span class="pre">True</span></code>. This will automatically draw those stimuli upon flipping the window, until you set this attribute to <code class="docutils literal notranslate"><span class="pre">False</span></code> again!</p>
</div>
</div>
<div class="section" id="frame-based-timing-optional">
<h3>Frame-based timing (optional)<a class="headerlink" href="#frame-based-timing-optional" title="Permalink to this headline">¶</a></h3>
<p>Although the clock-based method is reasonably accurate, it implicitly assumes that stimulus duration is <em>continuous</em>, while in reality it is discrete! This is because your monitor “draws” your screen contents at the <em>refresh rate</em> of your monitor. Most standard laptop screens and external computer monitors have a refresh rate of 60 Hz, meaning that it is technically able to redraw the entire screen 60 times per second. The first two minutes of video below explains the concept of refresh rate quite well:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/YCWZ_kWTB9w" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<div class="sidebar">
<p class="sidebar-title">Refresh vs. frame rate</p>
<p>One way to think about the difference between refresh and frame rate is that the former is determined (and limited) by your monitor while the latter is determined (and limited) by your graphics processor (as well as your monitor).</p>
</div>
<p>Note that the video also talks about the <em>frame rate</em> (or <em>frames per second</em>, FPS). This concept is related to the refresh rate, but it quantifies how often your screen can <em>actuallly</em> (in reality) be refreshed. Ideally, the refresh rate and the frame rate are exactly the same, but when you’re playing very high resolution video games or are running intricate PsychoPy experiments in which you’re drawing many visual components, your graphics processor may not be able to draw everything in time! When this happens, you’re likely “dropping frames” (for more explanation about this, check out the <a class="reference external" href="https://www.psychopy.org/general/timing/detectingFrameDrops.html">PsychoPy docs</a>).</p>
<p>The fact that monitors are limited by their refresh rate means that the <em>exact</em> duration of visual stimuli is some multiple of the number of screen refreshes. For example, if you have a 60 Hz screen (which refreshes every 1/60 seconds), a stimulus can be shown for 0.0167 seconds (1/60), 0.0333 seconds (2/60), 0.0500 seconds (3/60), etc. But it cannot be shown for, let’s say, <em>exactly</em> 110 milliseconds.</p>
<div class="attention admonition">
<p class="admonition-title"> ToThink</p>
<p>Suppose you want to show a stimulus for 120 milliseconds on a monitor with a refresh rate of 60 Hz. What is the duration closest to 120 milliseconds you can achieve?</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click here to see the answer (but try to come up with the answer yourself first)!<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<p class="card-text">Dividing 120 milliseconds (0.120 seconds) by the refresh rate (1/60) does not result in a whole (integer) number, namely 7.2. This means that 7 frames/flips is the best we can do, which results in 7 * (1/60) = 0.1167 seconds.</p>
</div>
</details></div>
<p>So, if you <em>really</em> care about the duration of your stimuli (e.g., in subliminal perception studies), you should specify the duration of your stimuli as a multiple of your refresh rate. Then, to implement this in your PsychoPy script, you can simply draw your stimuli and flip your window as often as the number of frames you want to show your stimuli. For example, if you want to show your stimulus for 60 frames (i.e., 1
second on a 60 Hz monitor), you simply do the drawing + flipping process 60 times!</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Remove the your clock-based timing implementation (i.e., the while loop from the previous ToDo) and instead program a frame-based timing implementation instead (the duration should be 500 ms for the stimulus and 1500 ms for the fixation target again). Hint: instead of the while loop in the clock-based timing example, you may want to use a for-loop here …
Run the experiment when you’re done!</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click here to show the solution (but try it yourself first!)<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># We&#39;ll assume you have a 60Hz monitor</span>
<span class="c1"># 120 frames on a 60Hz monitor is 2000 ms</span>
<span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">120</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">frame</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
        <span class="n">stim_img</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">stim_txt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fix_target</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="n">win</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For timing precision and preventing dropped frames, it is very important that no other (CPU-heavy) programs are running while you’re running your experiment! So make sure that, when you conduct actual experiments, you shut down all non-essential programs before starting your experiment.</p>
</div>
</div>
</div>
<div class="section" id="trial-loops">
<h2>Trial loops<a class="headerlink" href="#trial-loops" title="Permalink to this headline">¶</a></h2>
<p>So far, we only presented a <em>single</em> trial with a emotion word (“happy”) and a(n angry) smiley (i.e., an incongruent trial). Like the color-word Stroop in the Builder tutorial, we’d like to present the participant multiple trials in which the two factors — emotion of the smiley (happy/angry) and the emotion word (“happy”/”angry”) — vary.</p>
<p>So how do we define the different conditions? One way would be two create two lists, one with emotion words and one with the emotion for the smileys, and to choose a random value of each list in each iteration of the trial loop. In our current simple experiment, however, we would recommend to pre-specify the conditions in a CSV or Excel file &amp;mdash just like we did in the Builder tutorial!</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Create a CSV or Excel file with two columns (named <code class="docutils literal notranslate"><span class="pre">smiley</span></code> and <code class="docutils literal notranslate"><span class="pre">word</span></code>) and, let’s say, twenty rows (excluding column names) with either “happy” or “angry” such that there are five trials of each possible emotion-word combination (just like you did in the Builder tutorial). Save it in the same directory as your Python script with the name <code class="docutils literal notranslate"><span class="pre">emo_conditions.xlsx</span></code> (or <code class="docutils literal notranslate"><span class="pre">emo_conditions.csv</span></code>). (If you want to see the “solution”, check out the <code class="docutils literal notranslate"><span class="pre">emo_conditions.xlsx</span></code> file in the <code class="docutils literal notranslate"><span class="pre">solutions/week_1</span></code> directory of the course materials).</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Instead of counterbalancing the conditions (here: emotion word and smiley type) yourself, you can use the <code class="docutils literal notranslate"><span class="pre">TrialHandler</span></code> class from the <a class="reference external" href="https://www.psychopy.org/api/data.html"><code class="docutils literal notranslate"><span class="pre">psychopy.data</span></code> module</a>, which counterbalances the conditions across trials for you! In addition to simple counterbalancing, this module also contains some very fancy classes for psychophysics “staircases” and such.</p>
</div>
<p>To load in the data, we can use our <em>pandas</em> skills! In case of a CSV file, we can use the <code class="docutils literal notranslate"><span class="pre">read_csv</span></code> function and in case of an Excel file, we can use the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_excel.html"><code class="docutils literal notranslate"><span class="pre">read_excel</span></code> function</a>.</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Read in your <code class="docutils literal notranslate"><span class="pre">emo_conditions.{csv,xlsx}</span></code> file and store the resulting <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object in a variable named <code class="docutils literal notranslate"><span class="pre">cond_df</span></code> (“conditions dataframe”).</p>
</div>
<p>We could start writing our trial loop by now, but this would present the trials just like we defined in the conditions file. Often, you’d want to present the trials in a (semi-)random order. To do so, we can simply shuffle the dataframe, which can be easily done using the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.sample.html"><code class="docutils literal notranslate"><span class="pre">sample</span></code> method</a> of <code class="docutils literal notranslate"><span class="pre">DataFrames</span></code> using a fraction (<code class="docutils literal notranslate"><span class="pre">frac</span></code>) of 1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cond_df</span> <span class="o">=</span> <span class="n">cond_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>This method randomly samples all rows (because <code class="docutils literal notranslate"><span class="pre">frac=1</span></code>) from the dataframe, which is the same as shuffling it. The next step is to start writing a our trial loop! Because we have a fixed number of trials, we can use a for loop across the rows of our dataframe. The <code class="docutils literal notranslate"><span class="pre">iterrows</span></code> method of dataframes generates, row by row, the index and the row itself (as a <code class="docutils literal notranslate"><span class="pre">Series</span></code> object), so it’s perfect for our purposes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cond_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Extract current word and smiley</span>
    <span class="n">curr_word</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">]</span>
    <span class="n">curr_smil</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;smiley&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Then, after extracting the smiley and word conditions, we can initialize a <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> with the current word and an <code class="docutils literal notranslate"><span class="pre">ImageStim</span></code> with the current smiley and then draw/flip them in a clock-based or frame-based loop, and repeat this process until our trial loop has finished! Important: when using the clock-based timing approach, make sure to <em>reset</em> your clock to 0 at every new iteration/trial (using the clock’s <a class="reference external" href="https://www.psychopy.org/api/core.html"><code class="docutils literal notranslate"><span class="pre">reset</span></code> method</a>).</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Try finishing the loop in the previous code snippet as indicated above. You may use either clock-based or frame-based timing. Run the experiment when you’re done!</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click here to show the solution (but try it yourself first!)<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cond_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Extract current word and smiley</span>
    <span class="n">curr_word</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">]</span>
    <span class="n">curr_smil</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;smiley&#39;</span><span class="p">]</span>

    <span class="c1"># Create and draw text/img</span>
    <span class="n">stim_txt</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">curr_word</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
    <span class="n">stim_img</span> <span class="o">=</span> <span class="n">ImageStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">curr_smil</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="p">)</span>

    <span class="c1"># Using clock-based timing here</span>
    <span class="n">trial_clock</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Draw stuff</span>
        
        <span class="k">if</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">stim_txt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">stim_img</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fix_target</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            
        <span class="n">win</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details></div>
<p>Alright, we are 95% done! The trial loop works as expected, but it’s currently not keeping track of any experimental information, like participant responses and stimulus onsets, which is discussed in the next section.</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo (optional)</p>
<p>Perhaps twenty trials are a little too few to estimate any meaningful effect … To increase our statistical power (for whatever effect we’re trying to estimate), we can simply repeat our trial loop a number of times (like the <code class="docutils literal notranslate"><span class="pre">nReps</span></code> property of Builder loops). Try to implement this such that the trial loop is repeated five times. Make sure that each repetition uses a different random order of trials.</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click here to show the solution (but try it yourself first!)<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N_REPS</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># 5 repetitions for now</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_REPS</span><span class="p">):</span>
    <span class="c1"># Shuffle the conditions again!</span>
    <span class="n">cond_df</span> <span class="o">=</span> <span class="n">cond_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cond_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="c1"># Extract current word and smiley</span>
        <span class="n">curr_word</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">]</span>
        <span class="n">curr_smil</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;smiley&#39;</span><span class="p">]</span>

        <span class="c1"># Create and draw text/img</span>
        <span class="n">stim_txt</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">curr_word</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
        <span class="n">stim_img</span> <span class="o">=</span> <span class="n">ImageStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">curr_smil</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="p">)</span>

        <span class="c1"># Using clock-based timing here</span>
        <span class="n">trial_clock</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># Draw stuff</span>
            
            <span class="k">if</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">stim_txt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="n">stim_img</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fix_target</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                
            <span class="n">win</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details></div>
</div>
<div class="section" id="saving-responses-and-stimulus-onsets">
<h2>Saving responses and stimulus onsets<a class="headerlink" href="#saving-responses-and-stimulus-onsets" title="Permalink to this headline">¶</a></h2>
<p>After the experimental session, we’d of course like to save some data from the experiment, whether that is just the onsets of the stimuli/trials (like in passive viewing paradigms in neuroimaging) or extensive participant response data (like in psychophysics experiments).</p>
<p>Because the Coder, unlike the Builder, does not save <em>anything</em> by default, we need to save any data we want to store ourselves. One neat way to do so is to use the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> object with the condition info to store information about the trials. For this experiment, let’s keep track and store three things: the participant response for each trial (“left”, “right”, or no keypress), the reaction time for each trial, and the onset of the stimulus.</p>
<p>Let’s start with keeping track of the actual participant response. We’ll, of course, use the <code class="docutils literal notranslate"><span class="pre">Keyboard</span></code> class as discussed in the previous tutorial.</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo (difficult!)</p>
<p>Using a <code class="docutils literal notranslate"><span class="pre">Keyboard</span></code> object, make sure that both the participant response to each trial (either “left”, “right” or no response) and the reaction time are saved in the conditions <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> (i.e., <code class="docutils literal notranslate"><span class="pre">cond_df</span></code>). Store them in columns with the names <code class="docutils literal notranslate"><span class="pre">response</span></code> and <code class="docutils literal notranslate"><span class="pre">reaction_time</span></code>. In case of no response, save the response and reaction time as “n/a”. If there are multiple responses within a trial, make sure to save only the last one. Run the experiment when you’re done to see whether everything works as expected. <strong>Bonus</strong>: also save whether the response is correct, incorrect, or missing (“n/a”) for each trial (in a column named <code class="docutils literal notranslate"><span class="pre">response_correct</span></code>).</p>
<p>Hint: to add the data (response/RT) to the <code class="docutils literal notranslate"><span class="pre">cond_df</span></code> dataframe, use the <code class="docutils literal notranslate"><span class="pre">loc</span></code> method! You can do these even if the column (<code class="docutils literal notranslate"><span class="pre">response</span></code> or <code class="docutils literal notranslate"><span class="pre">response_time</span></code>) does not yet exist!</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click here to show the solution (but try it yourself first!)<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize keyboard if not done already</span>
<span class="n">kb</span> <span class="o">=</span> <span class="n">Keyboard</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cond_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Extract current word and smiley</span>
    <span class="n">curr_word</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">]</span>
    <span class="n">curr_smil</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;smiley&#39;</span><span class="p">]</span>

    <span class="c1"># Create and draw text/img</span>
    <span class="n">stim_txt</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">curr_word</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
    <span class="n">stim_img</span> <span class="o">=</span> <span class="n">ImageStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">curr_smil</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="p">)</span>

    <span class="c1"># Set initially to &quot;n/a&quot;</span>
    <span class="n">cond_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;response&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;n/a&quot;</span>
    <span class="n">cond_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;reaction_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;n/a&quot;</span>

    <span class="c1"># Using clock-based timing here</span>
    <span class="n">trial_clock</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">kb</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Draw stuff</span>
        
        <span class="k">if</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">stim_txt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">stim_img</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fix_target</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            
        <span class="n">win</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="c1"># Get responses</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">kb</span><span class="o">.</span><span class="n">getKeys</span><span class="p">([</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># if not an empty list ...</span>
            <span class="c1"># Only pick the last one [-1]</span>
            <span class="c1"># Overwrite existing data with current one!</span>
            <span class="n">cond_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;response&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="n">cond_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;reaction_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rt</span>
</pre></div>
</div>
</div>
</details></div>
<p>One last thing that would be nice to save is the onset of each stimulus (i.e., the smiley+word combination) and/or response. For most behavioral experiment this is probably not very interesting, but it is super important for neuroimaging (fMRI, EEG, or MEG) and physiological (eyetracking, ECG, EMG, etc.) experiment in case you want to analyze stimulus-related or response-related correlates in brain or physiological activity! For neuroimaging/physiological data with a high sampling rate (e.g., electrophysiology), you moreover have to be very precise in determining the stimulus onsets, as a difference of a couple of milliseconds may lead to very different effects and their interpretation!</p>
<p>Alright, so it would be nice to save the onsets of our stimuli. But the onset relatively to … what, exactly? In other words, when do we want to start our clock that is going to keep track of the onsets? In case of neuroimaging/physiological studies, this is the moment you start your data acquisition (e.g., the first pulse of your fMRI experiment). At that moment, we would need to <code class="docutils literal notranslate"><span class="pre">reset</span></code> our clock such that it is in sync with the external data acquisition! We recommend to using a separate clock (a “global clock”, to differentiate it from the “trial clock” we talked about earlier) to keep track of the stimulus onsets.</p>
<p>Then, assuming our clock has been reset at the appropriate moment, how do we make sure we save the stimulus onset <em>only</em> after the first flip? There are actually many ways in which you could do this!</p>
<div class="attention admonition">
<p class="admonition-title"> ToDo</p>
<p>Try to think of a way to save the onset of each stimulus (in the <code class="docutils literal notranslate"><span class="pre">cond_df</span></code> dataframe) after the first flip and implement this in your script. You may use the global clock (the <code class="docutils literal notranslate"><span class="pre">clock</span></code> variable) we defined in the previous tutorial. Make sure to reset it before the trial loop! Also, after the end of the loop, make sure to save the <code class="docutils literal notranslate"><span class="pre">cond_df</span></code> dataframe to disk with the name: <code class="docutils literal notranslate"><span class="pre">sub-{participant</span> <span class="pre">nr}_events.csv</span></code> (where <code class="docutils literal notranslate"><span class="pre">participant</span> <span class="pre">nr</span></code> refers to the value from the dialog box).</p>
<details class="sphinx-bs dropdown card mb-3">
<summary class="summary-title card-header">
Click here to show the solution (but try it yourself first!)<div class="summary-down docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="summary-up docutils">
<svg version="1.1" width="24" height="24" class="octicon octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="summary-content card-body docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># We left out the response/RT part for clarity</span>
<span class="c1"># Reset &quot;global&quot; clock!</span>
<span class="n">clock</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">cond_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Extract current word and smiley</span>
    <span class="n">curr_word</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;word&#39;</span><span class="p">]</span>
    <span class="n">curr_smil</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;smiley&#39;</span><span class="p">]</span>

    <span class="c1"># Create and draw text/img</span>
    <span class="n">stim_txt</span> <span class="o">=</span> <span class="n">TextStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">curr_word</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
    <span class="n">stim_img</span> <span class="o">=</span> <span class="n">ImageStim</span><span class="p">(</span><span class="n">win</span><span class="p">,</span> <span class="n">curr_smil</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="p">)</span>

    <span class="c1"># Initialize with None, which will be overwritten on </span>
    <span class="c1"># the first flip</span>
    <span class="n">onset</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">trial_clock</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">trial_clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">stim_txt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="n">stim_img</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fix_target</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            
        <span class="n">win</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="c1"># Get onset only after the first flip!</span>
        <span class="k">if</span> <span class="n">onset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">onset</span> <span class="o">=</span> <span class="n">clock</span><span class="o">.</span><span class="n">getTime</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details></div>
</div>
<div class="section" id="non-slip-timing-optional">
<h2>Non-slip timing (optional)<a class="headerlink" href="#non-slip-timing-optional" title="Permalink to this headline">¶</a></h2>
<p>If you managed to implement the last ToDo and you inspected the saved logfile, you might have noticed that the onsets seem to increase with a <em>little</em> more than 2 seconds. This inconsistency likely comes from the fact that the while loop we used to control the trial duration probably does not end neatly before the next screen refresh. Another reason is that the initialization of the new <code class="docutils literal notranslate"><span class="pre">TextStim</span></code> and <code class="docutils literal notranslate"><span class="pre">ImageStim</span></code> takes a little time that causes the routine to take a little longer than two seconds.</p>
<p>For most experiments, this issue is not really important, but for fMRI experiments it actually may be! This is because the data acquisition of fMRI scans is often predetermined (e.g., 250 “MRI volumes” of 2 seconds each → 500 seconds) and this issue may cause the experiment to “overshoot” the actual data acquisition (read more about this issue <a class="reference external" href="https://www.psychopy.org/general/timing/nonSlipTiming.html">here</a>).</p>
<p>To fix this “overshoot” issue, we need to compensate for the inaccuracies in our stimulus/trial durations; this is sometimes called <a class="reference external" href="https://www.psychopy.org/general/timing/nonSlipTiming.html">non-slip timing</a>. One way we can compensate these “overshoots” is using the clock itself. Instead of using it as a “stopwatch” (looping until it has reached a value), we can use it as a “timer” (looping until it has no time left anymore). This can be done using the <code class="docutils literal notranslate"><span class="pre">add</span></code> method of <code class="docutils literal notranslate"><span class="pre">Clock</span></code> objects, which (paradoxically) subtract time from the clock. For example, if you’d call <code class="docutils literal notranslate"><span class="pre">add(2)</span></code> right after resetting a clock, <code class="docutils literal notranslate"><span class="pre">getTime</span></code> would return approximately -2. Using this approach, we could subsequently loop until the clock is at 0, at which point we know the routine took 2 seconds. Any “overshoot” will then automatically be corrected for in the next routine.</p>
<p>Written out in code, this would look something like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clock</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="c1"># Set the clock to approx. -2 seconds</span>
    <span class="n">clock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Do some stuff, like initializing components</span>
    <span class="c1"># ...</span>

    <span class="c1"># Loop until clock is at 0</span>
    <span class="k">while</span> <span class="n">clock</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># do stuff</span>
</pre></div>
</div>
<div class="attention admonition">
<p class="admonition-title"> ToDo (optional)</p>
<p>Try implementing this non-slip timing approach in your emotion-word Stroop experiment. Then, run the experiment and check the resulting logfile. Is the overshoot issue fixed?</p>
</div>
</div>
<div class="section" id="wrapping-up">
<h2>Wrapping up<a class="headerlink" href="#wrapping-up" title="Permalink to this headline">¶</a></h2>
<p>Okay, that will have to do for this Coder tutorial. We discussed how to implement the most important experiment features using the <code class="docutils literal notranslate"><span class="pre">psychopy</span></code> package, but the package offers much more than we discussed here (such as auditory components, colorspaces, array stimuli, rating stimuli, and eyetracker integration). We leave this up to you to explore on your own. On the <a class="reference internal" href="psychopy_how_to_continue.html"><span class="doc std std-doc">next page</span></a>, we included some resources to help you with this.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./week_2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="psychopy_coder_part1.html" title="previous page">Introduction to the PsychoPy Coder (tutorial)</a>
    <a class='right-next' id="next-link" href="psychopy_how_to_continue.html" title="next page">How to continue with PsychoPy?</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Lukas Snoek<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>